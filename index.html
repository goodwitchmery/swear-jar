<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Swear Jar</title>
  <style>
    body {
      background-color: black;
      color: orange;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    h1 {
      font-size: 3em;
      text-shadow: 0 0 20px orange;
      margin-bottom: 20px;
    }
    button {
      background-color: orange;
      border: none;
      border-radius: 8px;
      padding: 10px 20px;
      margin: 10px;
      font-size: 1.2em;
      cursor: pointer;
      transition: 0.2s;
    }
    button:hover {
      background-color: darkorange;
    }
  </style>
</head>
<body>
  <h1>Swear count: <span id="count">0</span></h1>
  <button id="listenBtn">üé§ Listening...</button>
  <button id="resetBtn">üîÅ Reset</button>

  <script>
    const countEl = document.getElementById("count");
    const listenBtn = document.getElementById("listenBtn");
    const resetBtn = document.getElementById("resetBtn");
    const workerURL = "https://swearjar.goodwitchmery.workers.dev";
    let listening = true;
    let recognition;

    // --- S≈Çowa uznawane za przekle≈Ñstwa ---
    const badWords = [
      "fuck", "shit", "bitch", "asshole", "bastard", "damn", "crap", "dick",
      "piss", "cock", "cunt", "motherfucker", "fucker", "slut", "whore", "bollocks",
      "bloody", "bugger", "arse", "twat", "prick", "goddamn", "wanker", "hell"
    ];

    // --- Pobierz aktualny licznik z Workera ---
    async function loadCount() {
      try {
        const res = await fetch(workerURL + "/count");
        const data = await res.json();
        countEl.textContent = data.count ?? 0;
      } catch (err) {
        console.error("B≈ÇƒÖd ≈Çadowania:", err);
      }
    }

    // --- Zaktualizuj licznik w Workerze ---
    async function updateCount(delta) {
      try {
        const res = await fetch(workerURL + "/increment", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ delta })
        });
        const data = await res.json();
        countEl.textContent = data.count ?? countEl.textContent;
      } catch (err) {
        console.error("B≈ÇƒÖd aktualizacji:", err);
      }
    }

    // --- Reset licznika ---
    async function resetCount() {
      try {
        const res = await fetch(workerURL + "/reset", { method: "POST" });
        const data = await res.json();
        countEl.textContent = data.count ?? 0;
      } catch (err) {
        console.error("B≈ÇƒÖd resetu:", err);
      }
    }

    // --- Rozpoznawanie mowy ---
    function startListening() {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition) {
        alert("Speech recognition not supported in this browser.");
        return;
      }
      recognition = new SpeechRecognition();
      recognition.lang = "en-US";
      recognition.continuous = true;
      recognition.interimResults = false;

      recognition.onresult = (event) => {
        const transcript = event.results[event.results.length - 1][0].transcript.toLowerCase();
        console.log("Heard:", transcript);
        const found = badWords.filter(word => transcript.includes(word));
        if (found.length > 0) {
          console.log("Swear detected!", found);
          updateCount(found.length);
        }
      };

      recognition.onerror = (event) => console.error("Recognition error:", event.error);
      recognition.onend = () => {
        if (listening) recognition.start();
      };

      recognition.start();
      listenBtn.textContent = "üõë Pause listening";
    }

    // --- Obs≈Çuga przycisk√≥w ---
    listenBtn.addEventListener("click", () => {
      if (listening) {
        listening = false;
        listenBtn.textContent = "üé§ Start listening";
        if (recognition) recognition.stop();
      } else {
        listening = true;
        startListening();
      }
    });

    resetBtn.addEventListener("click", () => {
      resetCount();
    });

    // --- Start ---
    loadCount();
    startListening();
  </script>
</body>
</html>
